import { EditIcon } from "@chakra-ui/icons";
import {
  Button,
  Flex,
  FormControl,
  Input,
  Modal,
  ModalBody,
  ModalContent,
  ModalFooter,
  ModalHeader,
  ModalOverlay,
  Table,
  TableContainer,
  Tbody,
  Td,
  Text,
  Th,
  Thead,
  Tooltip,
  Tr,
  useDisclosure,
  VStack,
} from "@chakra-ui/react";
import Image from "next/image";
import { useRouter } from "next/router";
import React, { useState } from "react";

const OverFlowText = ({ children, label }) => {
  return (
    <Tooltip
      label={label ?? "-"}
      hasArrow
      placement="bottom-start"
      borderRadius={"10px"}
      p="12px"
    >
      <Td maxW="200px" w={200}>
        <Flex>
          {children}
          <div
            style={{
              textOverflow: "ellipsis",
              whiteSpace: "nowrap",
              overflow: "hidden",
              maxWidth: "200px",
            }}
          >
            {label ?? "-"}
          </div>
        </Flex>
      </Td>
    </Tooltip>
  );
};

const StudentTable = ({ children, admin, contract, students }) => {
  const router = useRouter();
  const { isOpen, onOpen, onClose } = useDisclosure();
  const [editStudentAccount, setEditStudentAccount] = useState("");
  // const onSaveAccount = () => {

  const onDiscard = () => {
    onClose();
    setEditStudentAccount("");
  };

  const handleOnInputChange = (e) => {
    const newData = { ...editStudentAccount };
    newData.account = e.target.value;
    setEditStudentAccount(newData);
  };

  const mintFunc = async (index) => {
    console.log(index);
    //global --> login with this account
    try {
      await contract.methods
        .mint(students[index].account, index, students[index].url)
        .send({ from: admin, gas: "1000000" });

      //เอา owner ไปเพ่ิม NFTในmetamaskต่อ
      const NFTOwner = await contract.methods
        .ownerOf(index)
        .send({ from: admin });
      console.log("Jack", NFTOwner);
    } catch (e) {
      console.log(e);
    }
  };

  return (
    <VStack pt={250} gap={5}>
      {children}
      <Text fontSize="5xl" color={"teal.400"} fontWeight="bold">
        Students who studying in a major of computer engineering in 2000
      </Text>
      <TableContainer maxW={"80%"} w="1500px" overflowX={"hidden"}>
        <Table variant="striped" colorScheme="teal" size={"sm"}>
          <Thead height={"50px"}>
            <Tr>
              <Th fontSize="lg">No.</Th>
              <Th fontSize="lg">ID</Th>
              <Th fontSize="lg">Phone Number</Th>
              <Th fontSize="lg">Firstname</Th>
              <Th fontSize="lg">Lastname</Th>
              <Th fontSize="lg">E-mail</Th>
            </Tr>
          </Thead>
          <Tbody>
            {students?.map((student, index) => (
              <Tr key={student.id}>
                <Td w={"60px"} fontSize={"md"}>
                  {student.token_id}
                </Td>
                <Td
                  fontSize={"md"}
                  w={"140px"}
                  _hover={{ color: "teal.500" }}
                  cursor="pointer"
                >
                  {student.student_id}
                </Td>
                <OverFlowText label={student?.wallet_account}></OverFlowText>
                <Td fontSize={"md"} w={"110px"}>
                  {student.firstname}
                </Td>
                <Td fontSize={"md"} w={"110px"}>
                  {student.lastname}
                </Td>
                <OverFlowText label={student?.ipfs_url}></OverFlowText>
              </Tr>
            ))}
          </Tbody>
        </Table>

        <Flex justifyContent={"space-between"}>
          <Tooltip
            label={"I'm sleepy"}
            hasArrow
            placement="right"
            borderRadius={"50%"}
            textAlign={"center"}
            pt="40px"
            w={280}
            h={150}
            fontSize={"4xl"}
          >
            <Image
              src="/yacht-1.png"
              alt="yacht"
              width="360"
              height="240"
              style={{
                minWidth: "360px",
                maxHeight: "240px",
                marginTop: "20px",
              }}
            />
          </Tooltip>
          <Tooltip
            label={"I'm sleepy"}
            hasArrow
            placement="right"
            borderRadius={"50%"}
            textAlign={"center"}
            pt="40px"
            w={280}
            h={150}
            fontSize={"4xl"}
          >
            <Image
              src="/yacht-2.png"
              alt="yacht"
              width="250"
              height="150"
              style={{
                transform: "scaleX(-1)",
              }}
            />
          </Tooltip>
        </Flex>
      </TableContainer>
    </VStack>
  );
};

export default StudentTable;
